// Generated by CoffeeScript 1.6.3
(function() {
  "use strict";
  var addItem, appendRow, login, loginFailure, loginSuccess, logout, user;

  user = {
    name: "",
    list: null,
    isLoggedIn: function() {
      return name === "";
    },
    login: function(username, password, onSuccess, onFailure) {
      /* Ajax request*/

      return $.post("/login", {
        username: username,
        password: password
      }).success(function(data) {
        user.name = data.name;
        user.list = data.list;
        if (typeof onSuccess === "function" && data.name !== "") {
          onSuccess(data);
        }
        if (typeof onFailure === "function" && data.name === "") {
          return onFailure();
        }
      }).fail(function() {
        var list;
        user.name = "";
        list = [];
        if (typeof onFailure === "function") {
          return onFailure();
        }
      });
    },
    logout: function(callBack) {
      return $.post("/logout").success(function() {
        user.name = "";
        user.list = [];
        if (typeof callBack === "function") {
          return callBack();
        }
      }).fail(function() {
        user.name = "";
        user.list = [];
        if (typeof callBack === "function") {
          return callBack();
        }
      });
    }
  };

  appendRow = function(val) {
    var $li;
    $li = $("<li></li>");
    $li.text(val);
    return $("ul").append($li);
  };

  addItem = function() {
    var val;
    val = $("#toDo").val().trim();
    if (val) {
      appendRow(val);
    }
    $("#toDo").val('');
    event.preventDefault();
    return false;
  };

  logout = function() {
    user.logout();
    $(".error").addClass("hide");
    $(".tasks").effect('drop', {}, 500, function() {
      $(".login").effect('slide', {
        direction: 'right'
      }, 500);
      $("ul").empty();
      return $(".nothing").removeClass('hide');
    });
    event.preventDefault();
    return false;
  };

  login = function() {
    user.login($("#username").val(), $("#password").val(), loginSuccess, loginFailure);
    event.preventDefault();
    return false;
  };

  loginSuccess = function() {
    $(".error").addClass("hide");
    $(".name").text(user.name);
    if (user.list.length) {
      $(".nothing").addClass('hide');
    }
    $.each(user.list, function(index, value) {
      return appendRow(value.item);
    });
    return $(".login").effect('drop', {}, 500, function() {
      $(".tasks").effect('slide', {
        direction: 'right'
      }, 500);
      return $("input").each(function() {
        return this.value = '';
      });
    });
  };

  loginFailure = function() {
    return $(".login").effect('shake', function() {
      return $(".error").removeClass("hide");
    });
  };

  /* trim whitespace*/


  String.prototype.trim = function() {
    return this.replace(/^\s+|\s+$/g, "");
  };

  /* Dom ready*/


  $(function() {
    /* Make the list sortable*/

    $("ul").sortable();
    $("#btnAdd").click(addItem);
    $("#btnLogout").click(logout);
    return $("#frmLogin").submit(login);
  });

}).call(this);
